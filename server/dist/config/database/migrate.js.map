{"version":3,"sources":["../../../src/config/database/migrate.js"],"names":["tables","Map","database","dbname","configParams","then","console","log","tableNames","query","none","catch","error","message"],"mappings":";;AAAA;;AACA;;;;AACA;;;;;;AAEA;AACA,MAAMA,SAAS,IAAIC,GAAJ,CAAQ,CACrB,CAAC,eAAD,EAAkB,oBAAK,yBAAL,CAAlB,CADqB,CAC8B;AAD9B,CAAR,CAAf;;AAIA,MAAM,EAAEC,UAAUC,MAAZ,uBAAN;AAAA,MAA6BC,YAA7B;;AAEA,uBAASA,YAAT,EAAuBD,MAAvB,EACGE,IADH,CACQ,MAAMC,QAAQC,GAAR,CAAa,cAAaJ,MAAO,wBAAjC,CADd,EAEGE,IAFH,CAEQ,MAAM;AACV,OAAK,IAAI,CAACG,UAAD,EAAaC,KAAb,CAAT,IAAgCT,MAAhC,EAAwC;AACtC,uBAAGU,IAAH,CAAQD,KAAR,EACGJ,IADH,CACQ,MAAMC,QAAQC,GAAR,CAAa,aAAYC,UAAW,YAAWL,MAAO,0BAAtD,CADd,EAEGQ,KAFH,CAESC,SAASN,QAAQM,KAAR,CAAe,kCAAiCT,MAAO,IAAvD,EAA4DS,MAAMC,OAAlE,CAFlB;AAGD;AACF,CARH,EASGF,KATH,CASSC,SAASN,QAAQM,KAAR,CAAe,0BAAyBT,MAAO,WAA/C,EAA2DS,MAAMC,OAAjE;;AAElB;AACA;;AAEA;AACA;;;;;;AAfA","file":"migrate.js","sourcesContent":["import { createdb } from 'pgtools'\r\nimport db, { load } from './database'\r\nimport { database } from '../settings'\r\n\r\n// used to migrate tables into a new database\r\nconst tables = new Map([\r\n  ['groups, tasks', load('schemes/schemeTasks.sql')] // Scheme for both tasks & taskGroups tables\r\n])\r\n\r\nconst { database: dbname, ...configParams } = database\r\n\r\ncreatedb(configParams, dbname)\r\n  .then(() => console.log(`Datatable '${dbname}' successfully created`))\r\n  .then(() => {\r\n    for (let [tableNames, query] of tables) {\r\n      db.none(query)\r\n        .then(() => console.log(`Table(s) '${tableNames}' in DB '${dbname}' successfully populated`))\r\n        .catch(error => console.error(`Error populating tables in DB '${dbname}':`, error.message))\r\n    }\r\n  })\r\n  .catch(error => console.error(`Creation of datatable '${dbname}' failed:`, error.message))\r\n\r\n// Note: to reset: you can use command 'yarn removedb',\r\n// but beware as whole datatable will be deleted !\r\n\r\n// CLI equivalents:\r\n/*\r\n \"removedb\": \"psql -U postgres -d livetasks -c \\\"SELECT pg_terminate_backend(pg_stat_activity.pid) FROM pg_stat_activity WHERE pg_stat_activity.datname = 'livetasks'\\\" -d postgres -c \\\"DROP DATABASE livetasks\\\"\",\r\n \"createdb\": \"createdb -U postgres livetasks\",\r\n \"populatedb\": \"psql -U postgres livetasks < ./server/src/config/database/schemes/schemeTasks.sql\",\r\n \"test\": \"psql -U postgres -d livetasks -c \\\"SELECT * from tasks\\\"\"\r\n */\r\n"]}
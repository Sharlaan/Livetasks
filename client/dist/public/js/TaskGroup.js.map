{"version":3,"sources":["../../../src/public/js/TaskGroup.js"],"names":["TaskGroup","id","name","baseApiUrl","socket","tasks","view","TaskGroupView","prototype","init","container","create","load","content","finished_at","createTask","updateCompletion","countRemainingTasks","length","emit","JSON","stringify","groupId","status","message","data","console","error","log","onTaskCreated","updateTask","finished","onTaskUpdated","removeTask","onTaskRemoved","created_at","push","deleted_at","task","find","index","findIndex","splice","reduce","total"],"mappings":"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","file":"TaskGroup.js","sourcesContent":["'use strict'\r\n/* eslint-disable camelcase */\r\n/**\r\n * Group constructor\r\n * @param {number} id - Group identifier\r\n * @param {string} name - Group Name\r\n * @param {string} baseApiUrl - URL for the API from which to fetch/send data\r\n * @param {Socket} socket - socket instance used for communicating with the API\r\n */\r\nfunction TaskGroup (id, name, baseApiUrl, socket) {\r\n  /**\r\n   * Identifier\r\n   * @type {number}\r\n   */\r\n  this.id = id\r\n\r\n  /**\r\n   * Name\r\n   * @type {string}\r\n   */\r\n  this.name = name\r\n\r\n  /**\r\n   * API url from which to fetch data\r\n   * @type {string}\r\n   */\r\n  this.baseApiUrl = baseApiUrl\r\n\r\n   /**\r\n    * @type {Socket}\r\n    */\r\n  this.socket = socket\r\n\r\n  /**\r\n   * Tasks\r\n   * @type {Array.<Object>}\r\n   */\r\n  this.tasks = []\r\n\r\n  /**\r\n   * The view\r\n   * @type {TaskGroupView}\r\n   */\r\n  this.view = new TaskGroupView(this) // eslint-disable-line no-undef\r\n}\r\n\r\n/**\r\n * Init\r\n * @param {DomElement} container - Container/Parent element\r\n * @return {boolean} True if everything was successful, otherwise false\r\n */\r\nTaskGroup.prototype.init = function (container) {\r\n  return this.view.create(container, this)\r\n}\r\n\r\n/**\r\n * Load tasks from an array\r\n * @param {Array.<Object>} tasks - The tasks\r\n */\r\nTaskGroup.prototype.load = function (tasks) {\r\n  // Load tasks\r\n  this.tasks = tasks\r\n  // Create views\r\n  for (let { id, content, finished_at } of tasks) {\r\n    this.view.createTask(id, content, (finished_at !== null))\r\n  }\r\n\r\n  // Update progression view\r\n  this.view.updateCompletion(this.countRemainingTasks(), this.tasks.length)\r\n}\r\n\r\n/**\r\n * Create a new task\r\n * @param {string} content - The content of the task\r\n */\r\nTaskGroup.prototype.createTask = function (content) {\r\n  this.socket.emit(\r\n    'createTask',\r\n    JSON.stringify({ groupId: this.id, content }),\r\n    ({status, message, data}) => {\r\n      if (status === 'failed') return console.error('Error with createTask fetch\\n', message)\r\n      console.log('createTask data', data)\r\n      // Add to the DOM\r\n      this.onTaskCreated(data)\r\n    }\r\n  )\r\n}\r\n\r\n/**\r\n * Update a task\r\n * @param {number} id - Task identifier\r\n * @param {string} content - The content of the task\r\n * @param {boolean} finished - True to set as finished, otherwise false\r\n */\r\nTaskGroup.prototype.updateTask = function (id, content, finished) {\r\n  // console.log('TaskGroup updateTask: Asking server for update (+ broadcast if successful)', {id, content, finished})\r\n  this.socket.emit(\r\n    'updateTask',\r\n    JSON.stringify({ id, content, finished }),\r\n    ({status, message, data}) => {\r\n      if (status === 'failed') return console.error('Error with updateTask fetch\\n', message)\r\n      // console.log('Server answered @ TaskGroup updateTask:', data)\r\n      this.onTaskUpdated(data) // Update the DOM element and its model\r\n    }\r\n  )\r\n}\r\n\r\n/**\r\n * Remove a given task\r\n * @param {number} id - Task identifier\r\n */\r\nTaskGroup.prototype.removeTask = function (id) {\r\n  this.socket.emit(\r\n    'removeTask',\r\n    JSON.stringify({ groupId: this.id, id }),\r\n    ({status, message, data}) => {\r\n      if (status === 'failed') return console.error('Error with removeTask fetch\\n', message)\r\n      // console.log'removeTask data', data)\r\n      this.onTaskRemoved(id) // Remove from the DOM\r\n    }\r\n  )\r\n}\r\n\r\n/**\r\n * Call when a task is created\r\n * @param {number} id - Task identifier\r\n * @param {string} content - The content of the task\r\n * @param {Date} created_at - Date of creation\r\n */\r\nTaskGroup.prototype.onTaskCreated = function ({ id, content, created_at }) {\r\n  this.tasks.push({id, content, created_at, finished_at: null, deleted_at: null})\r\n  this.view.createTask(id, content, false, true)\r\n  this.view.updateCompletion(this.countRemainingTasks(), this.tasks.length)\r\n}\r\n\r\n/**\r\n * Call when a task is updated\r\n * @param {number} id Task - identifier\r\n * @param {string} content - Task content\r\n * @param {string} finished_at - Completion date\r\n */\r\nTaskGroup.prototype.onTaskUpdated = function ({ id, content, finished_at }) {\r\n  // console.log'onTaskUpdated\\nfinished_at', finished_at, '\\ncontent', content)\r\n  // Update model\r\n  const task = this.tasks.find(task => task.id === id)\r\n  if (task) {\r\n    task.content = content\r\n    task.finished_at = finished_at\r\n  }\r\n\r\n  // Update view\r\n  this.view.updateTask(id, content, finished_at)\r\n  this.view.updateCompletion(this.countRemainingTasks(), this.tasks.length)\r\n}\r\n\r\n/**\r\n * Call when a task is removed\r\n * @param {number} id - Task identifier\r\n */\r\nTaskGroup.prototype.onTaskRemoved = function (id) {\r\n  // Remove model\r\n  const index = this.tasks.findIndex(task => task.id === +id)\r\n  if (index !== -1) this.tasks.splice(index, 1)\r\n\r\n  // Update view\r\n  this.view.removeTask(id)\r\n  this.view.updateCompletion(this.countRemainingTasks(), this.tasks.length)\r\n}\r\n\r\n/**\r\n * Count un-completed tasks\r\n * @return {number} - A positive integer\r\n */\r\nTaskGroup.prototype.countRemainingTasks = function () {\r\n  return this.tasks.reduce((total, task) => {\r\n    return total += task.finished_at === null ? 1 : 0 // eslint-disable-line no-return-assign\r\n  }, 0)\r\n}\r\n"]}